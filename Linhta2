local ServerScriptService = game:GetService("ServerScriptService")
local TweenService = game:GetService("TweenService")
local UnitAI = require(ServerScriptService:WaitForChild("UnitAI"))

-- 1. ĐỊNH NGHĨA KỸ NĂNG RIÊNG
local function ChieuBanCung(npc, mucTieu, satThuong)
	-- Tạo mũi tên
	local dan = Instance.new("Part")
	dan.Name = "MuiTen"
	dan.Size = Vector3.new(0.5, 0.5, 2)
	dan.Color = Color3.fromRGB(255, 255, 0)
	dan.Anchored = true
	dan.CanCollide = false
	dan.CFrame = CFrame.new(npc.HumanoidRootPart.Position + Vector3.new(0, 1, 0), mucTieu.Position)
	dan.Parent = workspace

	-- Bay đến mục tiêu
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Linear)
	local tween = TweenService:Create(dan, tweenInfo, {Position = mucTieu.Position})
	tween:Play()

	tween.Completed:Connect(function()
		dan:Destroy()

		-- [SỬA LỖI TẠI ĐÂY] Kiểm tra xem mục tiêu và cha của nó còn tồn tại không
		if mucTieu and mucTieu.Parent then
			local eHum = mucTieu.Parent:FindFirstChild("Humanoid")
			if eHum then 
				eHum:TakeDamage(satThuong) 
			end
		end
	end)
end

-- 2. CẤU HÌNH VÀ GỬI KỸ NĂNG CHO AI
local config = {
	AnimationID = "rbxassetid://507777826",
	KyNangTanCong = ChieuBanCung 
}

UnitAI.KhoiTao(script.Parent, config)
