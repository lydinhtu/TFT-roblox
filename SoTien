local Players = game:GetService("Players")
local player = Players.LocalPlayer
local Mouse = player:GetMouse()
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- === PHáº¦N 1: HIá»‚N THá»Š TIá»€N (Code gá»‘c cá»§a báº¡n) ===
local textLabel = script.Parent -- Script nÃ y pháº£i náº±m bÃªn trong TextLabel
local leaderstats = player:WaitForChild("leaderstats")
local gold = leaderstats:WaitForChild("Gold")

local function CapNhatTien()
	textLabel.Text = tostring(gold.Value) .. " G"
end

-- Cáº­p nháº­t láº§n Ä‘áº§u vÃ  láº¯ng nghe thay Ä‘á»•i
CapNhatTien()
gold.Changed:Connect(CapNhatTien)


-- === PHáº¦N 2: Xá»¬ LÃ CLICK VÃ€ DI CHUYá»‚N (Code Ä‘Ã£ sá»­a lá»—i) ===
local SuKienDiChuyen = ReplicatedStorage:WaitForChild("SuKienDiChuyen")
local DangDanhNhau = ReplicatedStorage:WaitForChild("DangDanhNhau")

local UnitDangChon = nil -- Biáº¿n lÆ°u con lÃ­nh Ä‘ang Ä‘Æ°á»£c chá»n
local SelectionBox = Instance.new("SelectionBox") -- Khung sÃ¡ng bao quanh lÃ­nh
SelectionBox.Color3 = Color3.fromRGB(0, 255, 0)
SelectionBox.LineThickness = 0.1

Mouse.Button1Down:Connect(function()
	-- Náº¿u Ä‘ang Ä‘Ã¡nh nhau thÃ¬ cáº¥m click lung tung
	if DangDanhNhau.Value == true then return end

	local target = Mouse.Target
	if not target then return end

	-- A. Náº¾U Báº¤M VÃ€O Má»˜T CON LÃNH (PHE TA) Äá»‚ CHá»ŒN
	local model = target:FindFirstAncestorOfClass("Model")
	if model and model:FindFirstChild("Humanoid") then
		local stats = model.Humanoid:FindFirstChild("Stats")
		-- Chá»‰ chá»n Ä‘Æ°á»£c lÃ­nh phe mÃ¬nh (Ally)
		if stats and stats:FindFirstChild("Team") and stats.Team.Value == "Ally" then
			UnitDangChon = model

			-- Hiá»‡n khung chá»n lÃªn
			SelectionBox.Adornee = model
			SelectionBox.Parent = model
			print("ğŸ‘‰ ÄÃ£ chá»n: " .. model.Name)
			return -- Dá»«ng láº¡i, chá» láº§n click tiáº¿p theo Ä‘á»ƒ di chuyá»ƒn
		end
	end

	-- B. Náº¾U ÄANG CHá»ŒN LÃNH -> Báº¤M VÃ€O Ã” Äáº¤T Äá»‚ DI CHUYá»‚N
	-- [QUAN TRá»ŒNG] ÄÃ£ thÃªm Ä‘iá»u kiá»‡n: target.Name:match("Slot")
	-- GiÃºp báº¡n báº¥m Ä‘Æ°á»£c vÃ o Ã´ hÃ ng chá» (Slot_1, Slot_2...)
	if UnitDangChon and (target.Name == "SanDau" or target.Name:match("Tile") or target.Name:match("Slot")) then

		print("ğŸ¯ Gá»­i lá»‡nh di chuyá»ƒn Ä‘áº¿n: " .. target.Name)

		-- Gá»­i yÃªu cáº§u di chuyá»ƒn lÃªn Server
		local viTriClick = Mouse.Hit.Position
		SuKienDiChuyen:FireServer(UnitDangChon, viTriClick)

		-- Bá» chá»n sau khi di chuyá»ƒn xong
		UnitDangChon = nil
		SelectionBox.Adornee = nil
		SelectionBox.Parent = nil
	end
end)
